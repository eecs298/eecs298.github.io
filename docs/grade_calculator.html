<!DOCTYPE html>
<html lang="en">
  <head>
    <!--CREDIT TO EECS 280 STAFF: https://eecs280.org/calculator.html-->
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="EECS 298"/>
    <meta name="keywords" content="EECS298, EECS 298, Social Consequences of Computing, University of Michigan Computer Science"/>
    <title>EECS 298</title>
    <!-- <link rel="shortcut icon" type="image/x-icon" href="assets/images/eecs280favicon.ico"> -->

    <!-- Fomantic UI CSS library
         https://fomantic-ui.com/introduction/getting-started.html#using-a-cdn-provider -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.1-beta.38/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.1-beta.38/dist/semantic.min.js"></script>

    <!-- Chartist Library
         https://gionkunz.github.io/chartist-js -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>

    <style>
      /*
      * Fomantic UI's invalid-input styles get overridden by styles for
      * right-labeled UIs, so we need to override the override :(
      * (This is for the grade calculator's inputs.)
      */
      input:invalid {
        background-color: #fff6f6 !important;
        border-color: #e0b4b4  !important;
        color: #9f3a38  !important;
        -webkit-box-shadow: none  !important;
        box-shadow: none  !important;
      }

      /* Avoid annoying arrows in number spinbox inputs for grade calculator */
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        /* display: none; <- Crashes Chrome on hover */
        -webkit-appearance: none;
        margin: 0; /* <-- Apparently some margin are still there even though it's hidden */
      }

      input[type=number] {
        -moz-appearance:textfield; /* Firefox */
      }

      .individual-lab-input {
        display: inline-block;
        width: 3.25em;
        padding-left: 0.15em;
        padding-right: 0.15em;
        text-align: center;
      }
      .individual-readingQ1-input {
        display: inline-block;
        width: 4.5em;
        padding-left: 0.15em;
        padding-right: 0.15em;
        text-align: center;
      }
      .individual-readingQ2-input {
        display: inline-block;
        width: 4.5em;
        padding-left: 0.15em;
        padding-right: 0.15em;
        text-align: center;
      }

      .individual-lab-input label {
        font-size: small;
        font-weight: bold;
        padding-left: 0;
        padding-right: 0;
      }

      .individual-lab-input input {
        text-align: center !important; 
        padding: 0.2em !important;
      }

      .individual-lab-input .lab-drop-label {
        display: inline-block;
        font-size: small;
        font-weight: bold;
        padding: 0.35em;
      }

      /* Exam distribution chart style */
      .ct-series-a .ct-bar {
        stroke: rgb(127, 127, 232);
        stroke-width: 4px;
      }
    </style>
  </head>

  <body>

    <!-- Main page  -->
    <div class="ui text container">
      <a class="ui right floated icon button" href=".">
        <i class="left arrow icon"></i> Back to main site
      </a>

        <h1>EECS 298 Grade Calculator</h1>
        <p>Calculate your EECS 298 letter grade or explore what-if scenarios.</p>

        <div id="grade-calculator" class="ui blue segment">
          
          <div style="vertical-align: middle;">
            <span class="ui toggle checkbox" style="float: right;" data-tooltip="Prefill values on your next visit to eecs298.github.io">
              <input type="checkbox" id="remember-scores">
              <label>Remember my scores</label>
            </span>
            
            <!-- <a href="https://youtu.be/ogZNEbDItQw" target="_blank"><b><i class="play circle icon"></i>Walkthrough Video</b></a> -->
            <!-- <span class="ui left pointing basic label">Watch Me!</span> -->
          </div>

          <div class="ui form" style="margin-top: 1.5em;">

            <div class="fields">

              <div class="thirteen wide field">
                <div>
                  <div class="individual-lab-input">
                    <label>Lab 1</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab1" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 2</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab2" max="5" min="0" step="any" inputmode="decimal" placeholder="0-5">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 3</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab3" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 4</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab4" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 5</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab5" max="2" min="0" step="any" inputmode="decimal" placeholder="0-2">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 6</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab6" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 7</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab7" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 8</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab8" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 9</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab9" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 10</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab10" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 11</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab11" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 12</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab12" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 13</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab13" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                </div>
                <div id="lab-entry-message" style="text-align: center; padding-top: 0.1em;">
                  <!-- <div class="ui medium label"> -->
                    <i class="ui right arrow circle icon"></i> Enter your raw score for each lab.
                  <!-- </div> -->
                </div>
              </div>

              <div class="three wide field">
                <label>Labs Overall (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input readonly">
                  <input id="overall-lab-input" style="cursor: not-allowed;" class="grade-calculator-input" readonly name="lab" type="number" max="100" min="0" step="any" inputmode="decimal">
                  <div class="ui basic label">%</div>
                </div>
              </div>

            </div>
            <div class="fields">
              <div class="sixteen wide field" style="text-align: right;">
                <!-- <b style="margin-right: 2em;">Labs</b> -->
                <div class="ui toggle checkbox">
                  <input type="checkbox" id="lab-method-checkbox">
                  <label style="padding-left: 4rem;">Apply Full Credit on Labs</label>
                </div>
              </div>
            </div>

            <div class="fields">
              <div class="fourteen wide field">
                <div>
                  <div class="individual-readingQ1-input">
                    <label>Number of Reading Questions with 1 point</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="readingQ1pt" max="24" min="0" step="any" inputmode="decimal" placeholder="0-24">
                    </div>
                    <!-- <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span> -->
                  </div>
                  <div class="individual-readingQ2-input">
                    <label>Number of Reading Questions with 2 points</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="readingQ2pts" max="24" min="0" step="any" inputmode="decimal" placeholder="0-24">
                    </div>
                    <!-- <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span> -->
                  </div>
                  <div class="three wide field">
                    <label>Reading Questions Overall (<span class="grade-calculator-weight"></span>%)</label>
                    <div class="ui right labeled input readonly">
                      <input id="overall-readingQ-input" style="cursor: not-allowed;" class="grade-calculator-input" readonly name="readingQs" type="number" max="100" min="0" step="any" inputmode="decimal">
                      <div class="ui basic label">%</div>
                    </div>
                  </div>

                </div>
              </div>
              <div id="readingQ-entry-message" style="text-align: center; padding-top: 0.1em;">
                <!-- <div class="ui medium label"> -->
                  <i class="ui right arrow circle icon"></i> Enter the number of reading questions submitted that received each amount of points. 
                <!-- </div> -->
              </div>
            </div>

            
            
            <div class="fields">
              <div class="three wide field">
                <label>Homework 1 Grade Percentage (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="hw1" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="three wide field">
                <label>Homework 2 Grade Percentage (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="hw2" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="three wide field">
                <label>Homework 3 Grade Percentage (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="hw3" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
            </div>

            <div class="fields">
              <br />
              <div class="four wide field">
                <label>Reading Presentation (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="readingPres" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="four wide field">
                <label>Discussion Memo 1 (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="dm1" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="four wide field">
                <label>
                  Discussion Memo 2 (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="dm2" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="four wide field">
                <label>
                  Midterm Evaluation Extra Credit (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="evalEC" type="number" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                  <span data-tooltip="Enter 1 if you submitted a midterm evaluation and 0 otherwise.">
                    <i class="ui question circle icon"></i>
                  </span>
                </div>
              </div>
              </div>
            <div class="fields">
              <div class="four wide field">
                <label>
                  Final Project Code of Conduct (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="FPCoC" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="four wide field">
                <label>
                  Final Project Description (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="FPDesc" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="four wide field">
                <label>
                  Final Project Outline (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="FPOutline" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="four wide field">
                <label>
                  Final Project Presentation (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="FPPres" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <div class="four wide field">
                <label>
                  Final Project Product and Report (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="FPReport" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              <br />
            </div>

            <div style="text-align: center;">
              <div class="ui label grade-calculator-output-note" style="display: inline-block; text-align: center; margin-bottom: 0.5em;"></div>
            </div>
            
            <button class="ui right floated basic blue compact button" id="calculator-clear">
              <i class="eraser icon"></i>Clear
            </button>

            <b>Overall Percent</b>
            <div class="ui basic label" style="margin-bottom: 0.5em">
              <span class="grade-calculator-output grade-calculator-output-score"></span>
            </div>
            
            <br />
          

            <b>Final Grade</b>
            <div class="ui basic label grade-calculator-output grade-calculator-output-letter-grade" style="margin-bottom: 0.5em">
              A
            </div>

          </div>
          
          <div class="ui accordion">
            <div class="title">
              <i class="dropdown icon"></i>
              How is this calculated?
            </div>
            <div class="content">
              <b>Overall Percent</b>
              <p>
                Your overall percent is the weighted average of percent scores on each assignment, according to the weights given in the syllabus and shown in parentheses above, e.g. "Labs (5%)".
              </p>

              <b>Final Grade</b>
              <p>
                Your final grade is determined according to the letter grade table from the syllabus.
              </p>
            </div>
            <div class="title">
              <i class="dropdown icon"></i>
              Where are my scores posted?
            </div>
            <div class="content">
              <p>
                Scores for all assignments are posted on <a class="item" href="https://www.gradescope.com/courses/702900/" target="_blank">Gradescope</a>. Enter those numbers here.
              </p>
            </div>
            <div class="title">
              <i class="dropdown icon"></i>
              Can I use the grade calculator or what-if tool on Canvas? (No.)
            </div>
            <div class="content">
              <p>
                Unfortunately, the grade computation and what-if tools on Canvas are misleading. Do not use them.
              </p>
            </div>
          </div>

        </div>
    
    </div><!-- /ui text container -->

    <script>
     // Grade calculator listeners and calculation

     // Assignment weights in percent
     const WEIGHTS = {
        "lab": 10,
        "hw1": 11.66,
        "hw2": 11.67,
        "hw3": 11.67,
        "readingQs": 5,
        "dm1": 5,
        "dm2": 5,
        "readingPres": 5,
        "FPCoC" : 3,
        "FPDesc": 4,
        "FPOutline": 5,
        "FPPres": 8,
        "FPReport": 15,
        "evalEC" : 1
     };

     // Sanity check weights add to 100 (except lecture points)
     if (Math.abs(Object.values(WEIGHTS).reduce((p,c)=>p+c,0) - 100 - 1) > 0.00001) {
       $("#grade-calculator").prepend('<span class="ui massive red label">ERROR: Weights do not add to 100%</span>')
     }

     // initialize weights displayed in the html
     $(".grade-calculator-input").each(function() {
       let assn = $(this).attr("name");
       let weight = WEIGHTS[assn];
       if (weight === undefined) {
         return;
       }
       let weight_html = $(this).parent().parent().find(".grade-calculator-weight");
       if (weight_html.length === 0) {
         weight_html = $(this).parent().parent().parent().find(".grade-calculator-weight");
       }
       weight_html.html(WEIGHTS[assn]);
     });

     // Grade thresholds in percent
     // Must be in increasing threshold order
     const THRESHOLDS = [
       [0, "E"],
       [60, "D"],
       [65, "D+"],
       [70, "C-"],
       [73, "C"],
       [78, "C+"],
       [80, "B-"],
       [84, "B"],
       [88, "B+"],
       [90, "A-"],
       [94, "A"]
     ];

     function pick(obj, keys) {
       let newobj = {};
       keys.forEach(k => newobj[k] = obj[k]);
       return newobj;
     }

     function letterGradeForPercent(percent) {
       return THRESHOLDS.slice().reverse().find(pair => percent >= pair[0])[1];
     }

     function minLetterGrade(originalLetterGrade, cappedGrade) {
       // Return the "lower" grade among the two, defined as
       // whichever one occurs first in the THRESHOLDS array
       return THRESHOLDS.map(pair => pair[1]).find(
         letterGrade => letterGrade === originalLetterGrade || letterGrade === cappedGrade
       );
     }

     function isValidScore(score, min, max) {
      if (min === undefined) { min = 0; }
      if (max === undefined) { max = 100; }
      return score !== undefined && !Number.isNaN(score) && min <= score && score <= max;
     }

     // weights - object mapping assignment names to weights
     // scores - object expected to contain keys for each name with the corresponding score
     function weightedAverage(weights, scores) {

       let weighted_percent = 0;
       let total_weight = 0;

       for(assn in weights) {
         let score = scores[assn];
         let weight = weights[assn];
         if (!isValidScore(score)) {
           return undefined;
         }

         total_weight += weight;
         weighted_percent += score * weight;
       }

       return (weighted_percent / total_weight);
     }

     function loadScoresFromStorage() {
       // load the scores from storage and update the inputs
       const stored_scores = JSON.parse(localStorage.getItem(REMEMBER_SCORES_STORAGE_KEY));
       $(".grade-calculator-input").each(function() {
         const assn = $(this).attr("name");
         const score = stored_scores[assn];
         if (score || score === 0) {
           $(this).val(score);
         }
       });
       $("#lab-method-checkbox").prop("checked", localStorage.getItem(LAB_METHOD_STORAGE_KEY) === "method");
     }

     function extractScores() {
       return Object.fromEntries(
         $(".grade-calculator-input").map(function() {
           // double nested array is to avoid jquery .map() built-in flattening
           return [[
             $(this).attr("name"),
             Number.parseFloat($(this).val())
           ]];
         })
       );
     }

     function updateScoreStorage(scores) {
       // Store items if set to remember scores
       if ($("#remember-scores").is(":checked")) {
         window.localStorage.setItem(REMEMBER_SCORES_STORAGE_KEY, JSON.stringify(scores));
         window.localStorage.setItem(LAB_METHOD_STORAGE_KEY, $("#lab-method-checkbox").is(":checked") ? "method" : "individual");
         
       }
       else {
         window.localStorage.removeItem(REMEMBER_SCORES_STORAGE_KEY);
         window.localStorage.removeItem(LAB_METHOD_STORAGE_KEY);
       }
     }

      function refreshLabScores() {
        // const TOTAL_LAB_POINTS = 26;
        const NUM_DROPS = 2;

        if ($("#lab-method-checkbox").is(":checked")) {
          $("#overall-lab-input").val(100);
          $("#lab-entry-message").hide();
          $(".individual-lab-input input").prop("disabled", true);
          $(".lab-drop-label").show();
          $(".lab-drop-label").css("visibility", "hidden");
          return;
        }
        
        
        $(".individual-lab-input input").prop("disabled", false);

        let indiv_labs = $(".individual-lab-input").map(function () {
          const input_elem = $(this).find("input");
          const drop_elem = $(this).find(".lab-drop-label");
          return {
            score: Number.parseFloat(input_elem.val()),
            drop_elem: drop_elem,
            max: input_elem.attr("max")
          };
        }).get();

        // Abort if we don't have scores for everything or a score is out of the valid range
        if (indiv_labs.some(lab => !isValidScore(lab.score, 0, lab.max))) {
          $("#overall-lab-input").val("");
          $("#lab-entry-message").show();
          $(".lab-drop-label").hide();
          return;
        }

        // Sort ascending
        indiv_labs.sort((lab1,lab2) => lab1.score/lab1.max - lab2.score/lab2.max);

        // Remove lowest NUM_DROPS
        const dropped = indiv_labs.splice(0, NUM_DROPS);

        // Compute the overall lab percent.
        // ASSUMPTION: all labs have equal weight.
        const lab_percent = indiv_labs.map(lab => lab.score/lab.max)
          .reduce((x,y) => x + y, 0) * 100;

        $("#overall-lab-input").val(lab_percent);
        $("#lab-entry-message").hide();
        $(".lab-drop-label").show();
        $(".lab-drop-label").css("visibility", "hidden");
        dropped.forEach(d => d.drop_elem.css("visibility", "visible"));
      }

      function refreshReadingScores() {
        const TOTAL_POINTS = 38;
        
        $(".individual-readingQ1-input input").prop("disabled", false);
        $(".individual-readingQ2-input input").prop("disabled", false);

        let num_indiv_readingQ1 = $(".individual-readingQ1-input").val();
        let num_indiv_readingQ2 = $(".individual-readingQ2-input").val();

        // Abort if we don't have scores for everything or a score is out of the valid range
        if (num_indiv_readingQ1 + num_indiv_readingQ2 > 24) {
          $("#overall-readingQ-input").val("");
          $("#readingQ-entry-message").show();
          return;
        }


        // Compute the overall lab percent.
        // ASSUMPTION: all labs have equal weight.
        const reading_percent = ((num_indiv_readingQ1 +(2*num_indiv_readingQ2)) / TOTAL_POINTS) * 100;

        $("#overall-readingQ-input").val(reading_percent);
        $("#readingQ-entry-message").hide();
      }

     function refreshCalculator() {

       // First, update the lab overall based on individual labs
       // and update the lecture percentage based on # of lectures.
       // These must be done before calling extractScores().
       refreshLabScores();
       refreshReadingScores();

       let scores = extractScores();

       updateScoreStorage(scores);

       const total_score = weightedAverage(WEIGHTS, scores);

       if (total_score === undefined) {
         $('.grade-calculator-output').html("?");
         $(".grade-calculator-output-project-warning").hide();
         $(".grade-calculator-output-exam-warning").hide();
         $('.grade-calculator-output-note').html("Please enter valid scores for all assignments to calculate your grade.");
         $(".grade-calculator-output-score-with-lecture").closest(".label").removeClass("disabled");
         $(".grade-calculator-output-score-without-lecture").closest(".label").removeClass("disabled");
         return;
       }

       $('.grade-calculator-output-note').html("Overall Percentage and Final Grade");

       // We DO NOT round anywhere in the calculator. However, we make the final percent more readable
       // by displaying only a certain number of characters after the . in the overall %, followed by ...
       // Note that this will always show a truncated, i.e. rounded down number.
       const NUM_DECIMALS_SHOWN = 5;
       let format_score = (score) => {
         score = "" + score;
         if (score.indexOf(".") === -1) { return score };
         const [n,f] = score.split(".");
         return n + "." + f.slice(0, NUM_DECIMALS_SHOWN) + (f.length > NUM_DECIMALS_SHOWN ? "..." : "");
       }
       
       $(".grade-calculator-output-score").html(format_score(total_score) + "%");


       const overall_percent = total_score;
       
       $(".grade-calculator-output-overall-percent").html(overall_percent + "%");
       let letterGrade = letterGradeForPercent(overall_percent);

       $(".grade-calculator-output-letter-grade").html(letterGrade);
     }

     $(".grade-calculator-input").on("input", refreshCalculator);

     // clear inputs when the clear button is clicked
     $("#calculator-clear").click(function() {
       $(".grade-calculator-input").each(function() {
         let assn = $(this).attr("name");
         $(this).val(null);
       });
       refreshCalculator();
     });

     const REMEMBER_SCORES_STORAGE_KEY = "remember-scores";
     const LAB_METHOD_STORAGE_KEY = "lab-method";

     // On click, update scores (or clear them)
     $("#remember-scores").click(function() {
       updateScoreStorage(extractScores());
     });

     // load the scores from storage if we have them
     const stored_scores = window.localStorage.getItem(REMEMBER_SCORES_STORAGE_KEY);
     if (stored_scores) {
       $("#remember-scores").prop("checked", true);
       loadScoresFromStorage();
       refreshCalculator();
     }

     // If lab mode toggle is clicked, refresh calculator
     $("#lab-method-checkbox").click(function() {
       refreshCalculator();
     });

     refreshCalculator();

    </script>

  <script>

    function applyCurve(raw_score, raw_mean, raw_stddev, target_mean, target_stddev) {
      const z_score = (raw_score - raw_mean) / raw_stddev;
      const curved_score = target_mean + z_score * target_stddev;
      return Math.max(0, Math.min(100, curved_score));
    }

    function computeCurvedScore(raw_score, ex_dist) {
      return Math.max(
        raw_score,
        applyCurve(raw_score, ex_dist.raw_mean, ex_dist.raw_stddev, ex_dist.target_mean, ex_dist.target_stddev)
      );
    }

    function computeRawScore(curved_score, ex_dist) {
      return Math.min(
        curved_score,
        applyCurve(curved_score, ex_dist.target_mean, ex_dist.target_stddev, ex_dist.raw_mean, ex_dist.raw_stddev)
      );
    }

    function setExamCalculatorDistribution(ex_dist) {
      $("#exam-calculator-raw-mean").val(ex_dist.raw_mean);
      $("#exam-calculator-raw-stddev").val(ex_dist.raw_stddev);
      $("#exam-calculator-target-mean").val(ex_dist.target_mean);
      $("#exam-calculator-target-stddev").val(ex_dist.target_stddev);

      $("#exam-calculator-distribution-description")
        .html(ex_dist.description)
        .removeClass()
        .addClass("ui message")
        .addClass(ex_dist.color);

      const labels = [
        null,null,null,null,null,
        "10",null,null,null,null,
        "20",null,null,null,null,
        "30",null,null,null,null,
        "40",null,null,null,null,
        "50",null,null,null,null,
        "60",null,null,null,null,
        "70",null,null,null,null,
        "80",null,null,null,null,
        "90",null,null,null,null,
        "100",null,null,null,null,
      ];

      let onDraw = () => {
        // Keep raw score, update everything else based on new distribution
        const raw_score = Number.parseFloat($("#raw-exam-score-input").val());
        setScores(raw_score, computeCurvedScore(raw_score, ex_dist));
      };

      let raw_chart = new Chartist.Bar('#exam-calculator-raw-chart', {
        labels: labels,
        series: [
          ex_dist.raw_bins
        ]
      }, {
        seriesBarDistance: 5,
      });
      raw_chart.on("draw", onDraw);
      
      let curved_chart = new Chartist.Bar('#exam-calculator-curved-chart', {
        labels: labels,
        series: [
          ex_dist.curved_bins
        ]
      });
      curved_chart.on("draw", onDraw);
    }

    function setScores(raw_score, curved_score) {
      
      // Note: Setting the value this way does not trigget another input event
      // Note: We only update the value if it's different than the current value
      //       in the input box. This prevents the case where someone is trying
      //       to type e.g. "86.5" but having their "86." get immediately changed
      //       back to "86"
      if (parseFloat($("#raw-exam-score-input").val()) !== raw_score) {
        $("#raw-exam-score-input").val(raw_score);
      }
      
      if (parseFloat($("#curved-exam-score-input").val()) !== curved_score) {
        $("#curved-exam-score-input").val(curved_score);
      }
      
      // The last "false" parameter here prevents the slider from firing an onMove event
      $("#raw-exam-score-slider").slider("set value", raw_score, false);
      $("#curved-exam-score-slider").slider("set value", curved_score, false);

      // Find the bar that corresponds to the raw/curved scores
      // This assumes 50 bars.
      const raw_bar_num = Math.min(49, Math.floor(raw_score / 2));
      const curved_bar_num = Math.min(49, Math.floor(curved_score / 2));

      $("#exam-calculator-raw-chart .ct-bar").css("stroke", ""); // unhighlight all 
      $("#exam-calculator-curved-chart .ct-bar").css("stroke", "");
      $("#exam-calculator-raw-chart .ct-bar").eq(raw_bar_num).css("stroke", "#e6d13d"); // highlight matching
      $("#exam-calculator-curved-chart .ct-bar").eq(curved_bar_num).css("stroke", "#e6d13d");
    }


    // Current and/or previous exam distributions
    // Bins are the # of students who scored 0-2%, 2-4%, ..., 98-100%.
    // The lower bounds are exclusive and upper bound inclusive, except
    // the top bin, which also includes 
    const EXAM_DISTRIBUTIONS = [{
      name: "W23 Midterm",
      is_available: true,
      description: "The Winter 2023 midterm was a more difficult exam, with a larger curve to compensate.",
      color: "red",
      raw_mean: 68.86,
      raw_stddev: 16.79,
      target_mean: 81,
      target_stddev: 9,
      raw_bins: [0,0,0,0,0,1,0,1,0,2,3,4,4,8,10,7,9,13,12,13,23,15,21,23,17,31,30,31,33,27,43,37,48,44,49,54,58,76,61,69,64,83,69,62,55,46,41,22,16,5],
      curved_bins: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,6,7,17,16,25,30,39,39,49,66,54,79,89,95,134,129,129,136,98,57,22,16,5]
    },
    // {
    //   name: "W23 Final",
    //   is_available: true,
    //   description: "The Winter 2023 final was a less difficult exam, so the curve was not as significant.",
    //   color: "orange",
    //   raw_mean: 76.83,
    //   raw_stddev: 15.23,
    //   target_mean: 81,
    //   target_stddev: 9,
    //   raw_bins: [0,0,0,0,0,0,0,0,0,0,0,0,2,2,1,6,5,3,5,8,4,17,12,15,9,11,14,15,22,28,23,30,29,40,44,51,47,46,53,50,72,84,87,86,80,72,59,44,44,18],
    //   curved_bins: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,1,2,3,6,7,8,20,23,15,27,27,46,49,63,89,76,81,111,143,123,81,73,59,44,44,18]
    // },
    {
      name: "F22 Midterm",
      is_available: true,
      color: "yellow",
      description: "The Winter 2023 final was a less difficult exam, with a small curve.",
      raw_mean: 75.58,
      raw_stddev: 14.7,
      target_mean: 81,
      target_stddev: 9,
      raw_bins: [0,0,0,0,0,0,0,0,1,1,1,4,1,1,4,5,2,3,3,4,2,8,9,8,10,7,8,18,20,25,34,31,40,42,48,44,64,47,62,56,51,54,60,87,47,66,56,23,28,5],
      curved_bins: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,4,2,8,4,5,5,11,14,15,14,28,47,51,69,74,92,92,85,81,115,93,66,56,23,28,5]
    },
    {
      name: "W19 Final",
      is_available: true,
      color: "green",
      description: "The Winter 2019 final exam was unusually difficult, with a significant curve.",
      raw_mean: 64.76,
      raw_stddev: 17.75,
      target_mean: 81,
      target_stddev: 9,
      raw_bins: [0,0,0,0,0,3,0,3,2,2,4,2,5,9,13,13,11,5,10,14,15,24,20,19,33,25,41,31,26,44,33,47,39,37,52,41,33,38,46,33,33,39,32,26,23,18,24,13,3,2],
      curved_bins: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,7,6,8,24,21,19,37,40,46,66,66,79,80,91,74,80,68,62,49,42,16,2]
    },
    // {
    //   name: "F23 Midterm",
    //   is_available: true,
    //   color: "blue",
    //   description: "The actual distribution and curve from the current Fall 2023 midterm exam.",
    //   raw_mean: 68.96,
    //   raw_stddev: 21.42,
    //   target_mean: 81,
    //   target_stddev: 9,
    //   raw_bins: [0,0,0,0,1,3,1,3,6,5,8,7,10,8,15,17,21,18,15,16,16,20,18,25,21,17,24,21,21,22,30,26,22,33,26,58,38,32,51,40,40,64,57,56,50,54,52,37,31,13],
    //   curved_bins: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,5,11,15,26,40,41,36,48,49,57,52,62,83,99,96,140,122,54,52,37,31,13]
    // },
    // {
    //   name: "F23 Final",
    //   is_available: true,
    //   color: "violet",
    //   description: "The actual distribution and curve from the current Fall 2023 final exam.",
    //   raw_mean: 79.68,
    //   raw_stddev: 18.56,
    //   target_mean: 81,
    //   target_stddev: 9,
    //   raw_bins: [0,0,0,0,0,0,1,1,2,3,2,0,5,4,4,5,6,4,10,3,7,7,11,15,5,14,13,12,12,17,19,20,19,17,19,29,37,31,28,33,39,52,60,50,63,69,97,92,78,65],
    //   curved_bins: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,4,3,9,9,11,15,15,23,22,28,33,34,40,61,60,76,61,60,50,63,69,97,92,78,65]
    // },
    {
      name: "W24 Midterm",
      color: "blue",
      is_available: false,
      description: "this is a description placeholder",
    },
    {
      name: "W24 Final",
      is_available: false,
      color: "violet",
      description: "this is a description placeholder",
    }];

    function initializeExamCalculator() {
      
      // SET INITIALLY DISPLAYED DISTRIBUTION HERE
      let current_distribution = EXAM_DISTRIBUTIONS[0];

      $("#raw-exam-score-input").on("input", function() {
        const raw_score = Number.parseFloat($(this).val());
        setScores(raw_score, computeCurvedScore(raw_score, current_distribution));
      })

      $("#raw-exam-score-slider").slider({
        min: 0,
        max: 100,
        onMove: function(raw_score) {
          setScores(raw_score, computeCurvedScore(raw_score, current_distribution));
        }
      });

      $("#curved-exam-score-input").on("input", function() {
        const curved_score = Number.parseFloat($(this).val());
        setScores(computeRawScore(curved_score, current_distribution), curved_score);
      })

      $("#curved-exam-score-slider").slider({
        min: 0,
        max: 100,
        onMove: function(curved_score) {
          setScores(computeRawScore(curved_score, current_distribution), curved_score);
        }
      });

      EXAM_DISTRIBUTIONS.forEach((ex_dist,i) => {
        let tab = $(`<button class="ui primary tertiary button">${ex_dist.name}</button>`);
        tab.addClass(ex_dist.color);
        if(ex_dist.name === current_distribution.name) { tab.addClass("active"); }
        if (ex_dist.is_available) {
          tab.on("click", function() {
            $("#exam-calculator-tabs button").removeClass("active");
            $(this).addClass("active");
            current_distribution = ex_dist;
  
            setExamCalculatorDistribution(ex_dist);
          });
        }
        else {
          tab.addClass("disabled");
        }
        $("#exam-calculator-tabs").append(tab);
        
      });

      // Initial raw score at mean of current distribution
      $("#raw-exam-score-input").val(current_distribution.raw_mean);
      setExamCalculatorDistribution(current_distribution);
    }

    initializeExamCalculator();

    // Initialize "how is this calculated?" accordion
    $(".ui.accordion").accordion();

  </script>
  
  <!-- Footer -->
  <footer class="ui vertical footer segment">
  </footer>

  </body>
</html>
