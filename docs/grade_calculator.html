<!DOCTYPE html>
<html lang="en">
  <head>
    <!--CREDIT TO EECS 280 STAFF: https://eecs280.org/calculator.html-->
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="EECS 298"/>
    <meta name="keywords" content="EECS298, EECS 298, Social Consequences of Computing, University of Michigan Computer Science"/>
    <title>EECS 298</title>
    <!-- <link rel="shortcut icon" type="image/x-icon" href="assets/images/eecs280favicon.ico"> -->

    <!-- Fomantic UI CSS library
         https://fomantic-ui.com/introduction/getting-started.html#using-a-cdn-provider -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.1-beta.38/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.1-beta.38/dist/semantic.min.js"></script>

    <!-- Chartist Library
         https://gionkunz.github.io/chartist-js -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>

    <style>
      /*
      * Fomantic UI's invalid-input styles get overridden by styles for
      * right-labeled UIs, so we need to override the override :(
      * (This is for the grade calculator's inputs.)
      */
      input:invalid {
        background-color: #fff6f6 !important;
        border-color: #e0b4b4  !important;
        color: #9f3a38  !important;
        -webkit-box-shadow: none  !important;
        box-shadow: none  !important;
      }

      /* Avoid annoying arrows in number spinbox inputs for grade calculator */
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        /* display: none; <- Crashes Chrome on hover */
        -webkit-appearance: none;
        margin: 0; /* <-- Apparently some margin are still there even though it's hidden */
      }

      input[type=number] {
        -moz-appearance:textfield; /* Firefox */
      }

      .individual-lab-input {
        display: inline-block;
        width: 3.25em;
        padding-left: 0.15em;
        padding-right: 0.15em;
        text-align: center;
      }
      .individual-assignment-input {
        display: inline-block;
        width: 10em;
        padding-left: 0.15em;
        padding-right: 0.15em;
        text-align: center;
      }

      .individual-lab-input label {
        font-size: small;
        padding-left: 0;
        padding-right: 0;
      }

      .individual-lab-input input {
        text-align: center !important; 
        padding: 0.2em !important;
      }

      .individual-lab-input .lab-drop-label {
        display: inline-block;
        font-size: small;
        font-weight: bold;
        padding: 0.35em;
      }

      /* Exam distribution chart style */
      .ct-series-a .ct-bar {
        stroke: rgb(127, 127, 232);
        stroke-width: 4px;
      }
    </style>
  </head>

  <body>

    <!-- Main page  -->
    <div class="ui text container">
      <a class="ui right floated icon button" href=".">
        <i class="left arrow icon"></i> Back to main site
      </a>

        <h1>EECS 298 Grade Calculator</h1>
        <p>Calculate your EECS 298 letter grade or explore what-if scenarios. Enter your scores below or enter percentages to test what-if scenarios for assignments that have not been released yet. You must enter a value in all fields to get a final grade calculation. Credit to <a href=https://eecs280.org/calculator.html>EECS 280</a> for original source code.</p>

        <div id="grade-calculator" class="ui blue segment">
          
          <div style="vertical-align: middle;">
            <span class="ui toggle checkbox" style="float: right;" data-tooltip="Prefill values on your next visit to eecs298.github.io">
              <input type="checkbox" id="remember-scores">
              <label>Remember my scores</label>
            </span>
            
            <!-- <a href="https://youtu.be/ogZNEbDItQw" target="_blank"><b><i class="play circle icon"></i>Walkthrough Video</b></a> -->
            <!-- <span class="ui left pointing basic label">Watch Me!</span> -->
          </div>

          <div class="ui form" style="margin-top: 1.5em;">

            <!--Homework Inputs-->

            <div class="fields">
              <div class="fifteen wide field">
                <div>
                <div class = "individual-assignment-input homework1">
                <label>Homework 1 Score </label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="hw1" type="number" max="58" min="0" step="any" inputmode="decimal" placeholder="0-58">
                </div>
              </div>
              <div class = "individual-assignment-input homework2">
                <label>Homework 2 Score </label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="hw2" type="number" max="65" min="0" step="any" inputmode="decimal" placeholder="0-65">
                </div>
              </div>
              <div class = "individual-assignment-input homework3">
                <label>Homework 3 Grade Percentage </label>
                <div class="ui right labeled input">
                  <input class="grade-calculator-input" name="hw3" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                  <div class="ui basic label">%</div>
                </div>
              </div>
              </div>
            </div>
              <div class="five wide field">
                <label>Homework Assignments Overall (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input readonly">
                  <input id="overall-homework-input" style="cursor: not-allowed;" class="grade-calculator-input" readonly name="homeworks" type="number" max="100" min="0" step="any" inputmode="decimal">
                  <div class="ui basic label">%</div>
                </div>
              </div>
            </div>

            <!--Reading Questions Inputs-->
            <div class="fields">
              <div class="fourteen wide field">
                <div>
                  <div class="individual-assignment-input readingQ1">
                    <label>Number of Reading Questions with 1 point</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="readingQ1pt" max="24" min="0" step="any" inputmode="decimal" placeholder="0-24">
                    </div>
                    <!-- <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span> -->
                  </div>
                  <div class="individual-assignment-input readingQ2">
                    <label>Number of Reading Questions with 2 points</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="readingQ2pts" max="24" min="0" step="any" inputmode="decimal" placeholder="0-24">
                    </div>
                    <!-- <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span> -->
                  </div>
                  <div id="readingQ-entry-message" style="text-align: center; padding-top: 0.1em;">
                    <!-- <div class="ui medium label"> -->
                      <i class="ui right arrow circle icon"></i> Enter the number of reading questions submitted that received each amount of points. Sum should not exceed 24 (total number of lectures) and we use your top 19 scores in the calculation.
                    <!-- </div> -->
                  </div>
                </div>
              </div>
              <div class="four wide field">
                <label>Reading Questions Total (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input readonly">
                  <input id="overall-readingQ-input" style="cursor: not-allowed;" class="grade-calculator-input" readonly name="readingQs" type="number" max="100" min="0" step="any" inputmode="decimal">
                  <div class="ui basic label">%</div>
                </div>
              </div>
            </div>


            <!--Discussion Memo & Reading Presentation Inputs-->
            <div class="fields">
              <div class = "fourteen wide field">
              <div>
              <div class="individual-assignment-input dm1">
                <label>Discussion Memo 1 Score (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="dm1" type="number" max="10" min="0" step="any" inputmode="decimal" placeholder="0-10">
                </div>
              </div>
              <div class="individual-assignment-input dm2">
                <label>
                  Discussion Memo 2 Score (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="dm2" type="number" max="10" min="0" step="any" inputmode="decimal" placeholder="0-10">
                </div>
              </div>
              <div class="individual-assignment-input readingPres">
                <label>Reading Presentation Score (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="readingPres" type="number" max="10" min="0" step="any" inputmode="decimal" placeholder="0-10">
                </div>
              </div>
              </div>
              </div>
              <div class="four wide field">
                <label>Participation Overall (Includes Reading Questions) (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input readonly">
                  <input id="overall-participation-input" style="cursor: not-allowed;" class="grade-calculator-input" readonly name="participation" type="number" max="100" min="0" step="any" inputmode="decimal">
                  <div class="ui basic label">%</div>
                </div>
              </div>
            </div>
            

            <!--Lab Inputs-->
            <div class="fields">

              <div class="thirteen wide field">
                <div>
                  <div class="individual-lab-input">
                    <label>Lab 1</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab1" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 2</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab2" max="5" min="0" step="any" inputmode="decimal" placeholder="0-5">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 3</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab3" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 4</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab4" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 5</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab5" max="2" min="0" step="any" inputmode="decimal" placeholder="0-2">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 6</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab6" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 7</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab7" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 8</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab8" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 9</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab9" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 10</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab10" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 11</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab11" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 12</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab12" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                  <div class="individual-lab-input">
                    <label>Lab 13</label>
                    <div class="ui input">
                      <input class="grade-calculator-input" type="number" name="lab13" max="3" min="0" step="any" inputmode="decimal" placeholder="0-3">
                    </div>
                    <span class="ui tiny green label lab-drop-label" data-tooltip="We drop your lowest two lab scores.">DROP</span>
                  </div>
                </div>
                <div id="lab-entry-message" style="text-align: center; padding-top: 0.1em;">
                  <!-- <div class="ui medium label"> -->
                    <i class="ui right arrow circle icon"></i> Enter your raw score for each lab.
                  <!-- </div> -->
                </div>
              </div>

              <div class="three wide field">
                <label>Labs Overall (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input readonly">
                  <input id="overall-lab-input" style="cursor: not-allowed;" class="grade-calculator-input" readonly name="lab" type="number" max="100" min="0" step="any" inputmode="decimal">
                  <div class="ui basic label">%</div>
                </div>
              </div>

            </div>

            <div class="fields">
              <div class="sixteen wide field" style="text-align: right;">
                <!-- <b style="margin-right: 2em;">Labs</b> -->
                <div class="ui toggle checkbox">
                  <input type="checkbox" id="lab-method-checkbox">
                  <label style="padding-left: 4rem;">Apply Full Credit on Labs</label>
                </div>
              </div>
            </div>

            
            <!--Final Inputs-->

            <div class="fields">
              <div class = "twelve wide field">
              <div>
              <div class="individual-assignment-input code">
                <label>
                  Final Project Code of Conduct (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="FPCoC" type="number" max="6" min="0" step="any" inputmode="decimal" placeholder="0-6">
                </div>
              </div>
              <div class="individual-assignment-input description">
                <label>
                  Final Project Description (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="FPDesc" type="number" max="8" min="0" step="any" inputmode="decimal" placeholder="0-8">
                </div>
              </div>
              <div class="individual-assignment-input outline">
                <label>
                  Final Project Outline (<span class="grade-calculator-weight"></span>%)
                </label>
                <div class="ui input">
                  <input class="grade-calculator-input" name="FPOutline" type="number" max="15" min="0" step="any" inputmode="decimal" placeholder="0-15">
                </div>
              </div>
              </div>
             </div>
             
            </div>

            <div class = "fields">
              <div class = "thirteen wide field">
                <div>
                  <div class="individual-assignment-input finalPres">
                    <label>
                      Final Project Presentation Percentage (<span class="grade-calculator-weight"></span>%)
                    </label>
                    <div class="ui right labeled input">
                      <input class="grade-calculator-input" name="FPPres" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                      <div class="ui basic label">%</div>
                    </div>
                  </div>
                  <div class="individual-assignment-input finalReport">
                    <label>
                      Final Project Product and Report Percentage (<span class="grade-calculator-weight"></span>%)
                    </label>
                    <div class="ui right labeled input">
                      <input class="grade-calculator-input" name="FPReport" type="number" max="100" min="0" step="any" inputmode="decimal" placeholder="0-100">
                      <div class="ui basic label">%</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="three wide field">
                <label>Final Project Overall (<span class="grade-calculator-weight"></span>%)</label>
                <div class="ui right labeled input readonly">
                  <input id="overall-final-input" style="cursor: not-allowed;" class="grade-calculator-input" readonly name="final" type="number" max="100" min="0" step="any" inputmode="decimal">
                  <div class="ui basic label">%</div>
                </div>
              </div>

            </div>

            <!--Course Eval Inputs-->
            <div class = "fields">
              <div class="thirteen wide field">
                <div>
                  <div class="individual-assignment-input">
                    <label>
                      Midterm Evaluation Extra Credit (<span class="grade-calculator-weight"></span>%)
                    </label>
                    <div class="ui input">
                      <input class="grade-calculator-input" name="midEvalEC" type="number" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                      <span data-tooltip="Enter 1 if you submitted a midterm evaluation and 0 otherwise.">
                        <i class="ui question circle icon"></i>
                      </span>
                    </div>
                  </div>
                  <div class="individual-assignment-input">
                    <label>
                      Final Evaluation Extra Credit (<span class="grade-calculator-weight"></span>%)
                    </label>
                    <div class="ui input">
                      <input class="grade-calculator-input" name="finEvalEC" type="number" max="1" min="0" step="any" inputmode="decimal" placeholder="0-1">
                      <span data-tooltip="Enter 1 if you submitted a final evaluation and 0 otherwise.">
                        <i class="ui question circle icon"></i>
                      </span>
                    </div>
                  </div>

                </div>
              </div>
            </div>







            <div style="text-align: center;">
              <div class="ui label grade-calculator-output-note" style="display: inline-block; text-align: center; margin-bottom: 0.5em;"></div>
            </div>
            
            <button class="ui right floated basic blue compact button" id="calculator-clear">
              <i class="eraser icon"></i>Clear
            </button>

            <b>Overall Percent</b>
            <div class="ui basic label" style="margin-bottom: 0.5em">
              <span class="grade-calculator-output grade-calculator-output-score"></span>
            </div>
            
            <br />
          

            <b>Final Grade</b>
            <div class="ui basic label grade-calculator-output grade-calculator-output-letter-grade" style="margin-bottom: 0.5em">
              A
            </div>

          </div>
          
          <div class="ui accordion">
            <div class="title">
              <i class="dropdown icon"></i>
              How is this calculated?
            </div>
            <div class="content">
              <b>Overall Percent</b>
              <p>
                Your overall percent is the weighted average of percent scores on each assignment, according to the weights given in the syllabus and shown in parentheses above, e.g. "Labs (10%)".
              </p>

              <b>Final Grade</b>
              <p>
                Your final grade is determined according to the letter grade table from the syllabus.
              </p>
            </div>
            <div class="title">
              <i class="dropdown icon"></i>
              Where are my scores posted?
            </div>
            <div class="content">
              <p>
                Scores for all assignments are posted on <a class="item" href="https://www.gradescope.com/courses/702900/" target="_blank">Gradescope</a>. Enter those numbers here.
              </p>
            </div>
            <div class="title">
              <i class="dropdown icon"></i>
              Can I use the grade calculator or what-if tool on Canvas? (No.)
            </div>
            <div class="content">
              <p>
                Unfortunately, the grade computation and what-if tools on Canvas are misleading. Do not use them.
              </p>
            </div>
          </div>

        </div>
    
    </div><!-- /ui text container -->

    <script>
     // Grade calculator listeners and calculation

     // Assignment weights in percent
     const WEIGHTS = {
        "lab": 10,
        "homeworks": 35,
        "readingQs": 5,
        "dm1": 5,
        "dm2": 5,
        "readingPres": 5,
        "participation": 20,
        "FPCoC" : 3,
        "FPDesc": 4,
        "FPOutline": 5,
        "FPPres": 8,
        "FPReport": 15,
        "final": 35,
        "midEvalEC" : 0.5,
        "finEvalEC":0.5,
     };

     // Sanity check weights add to 100 (except lecture points)
     if (Math.abs(Object.values(WEIGHTS).reduce((p,c)=>p+c,0) - 100 - 56) > 0.00001) {
       $("#grade-calculator").prepend('<span class="ui massive red label">ERROR: Weights do not add to 100%</span>')
     }

     // initialize weights displayed in the html
     $(".grade-calculator-input").each(function() {
       let assn = $(this).attr("name");
       let weight = WEIGHTS[assn];
       if (weight === undefined) {
         return;
       }
       let weight_html = $(this).parent().parent().find(".grade-calculator-weight");
       if (weight_html.length === 0) {
         weight_html = $(this).parent().parent().parent().find(".grade-calculator-weight");
       }
       weight_html.html(WEIGHTS[assn].toString().slice(0,5));
     });

     // Grade thresholds in percent
     // Must be in increasing threshold order
     const THRESHOLDS = [
       [0, "E"],
       [60, "D"],
       [65, "D+"],
       [70, "C-"],
       [73, "C"],
       [78, "C+"],
       [80, "B-"],
       [84, "B"],
       [88, "B+"],
       [90, "A-"],
       [94, "A"]
     ];

     function pick(obj, keys) {
       let newobj = {};
       keys.forEach(k => newobj[k] = obj[k]);
       return newobj;
     }

     function letterGradeForPercent(percent) {
       return THRESHOLDS.slice().reverse().find(pair => percent >= pair[0])[1];
     }

     function minLetterGrade(originalLetterGrade, cappedGrade) {
       // Return the "lower" grade among the two, defined as
       // whichever one occurs first in the THRESHOLDS array
       return THRESHOLDS.map(pair => pair[1]).find(
         letterGrade => letterGrade === originalLetterGrade || letterGrade === cappedGrade
       );
     }

     function isValidScore(score, min, max) {
      if (min === undefined) { min = 0; }
      if (max === undefined) { max = 100; }
      return score !== undefined && !Number.isNaN(score) && min <= score && score <= max;
     }

     // weights - object mapping assignment names to weights
     // scores - object expected to contain keys for each name with the corresponding score
     function weightedAverage(weights, scores) {
        let categories = ["homeworks", "lab", "participation", "final"];
        let weighted_percent = 0;
        let total_weight = 0;
        for (category_idx in categories) {
          if (!isValidScore(scores[categories[category_idx]])){
            return undefined;
          }
          weighted_percent += scores[categories[category_idx]] * weights[categories[category_idx]]
          total_weight += weights[categories[category_idx]]
        }
        let finalAverage = weighted_percent / total_weight;

       return finalAverage + scores["midEvalEC"]*weights["midEvalEC"] +scores["finEvalEC"]*weights["finEvalEC"] ; // add a percentage if evals are done
     }

     function loadScoresFromStorage() {
       // load the scores from storage and update the inputs
       const stored_scores = JSON.parse(localStorage.getItem(REMEMBER_SCORES_STORAGE_KEY));
       $(".grade-calculator-input").each(function() {
         const assn = $(this).attr("name");
         const score = stored_scores[assn];
         if (score || score === 0) {
           $(this).val(score);
         }
       });
       $("#lab-method-checkbox").prop("checked", localStorage.getItem(LAB_METHOD_STORAGE_KEY) === "method");
     }

     function extractScores() {
       return Object.fromEntries(
         $(".grade-calculator-input").map(function() {
           // double nested array is to avoid jquery .map() built-in flattening
           return [[
             $(this).attr("name"),
             Number.parseFloat($(this).val())
           ]];
         })
       );
     }

     function updateScoreStorage(scores) {
       // Store items if set to remember scores
       if ($("#remember-scores").is(":checked")) {
         window.localStorage.setItem(REMEMBER_SCORES_STORAGE_KEY, JSON.stringify(scores));
         window.localStorage.setItem(LAB_METHOD_STORAGE_KEY, $("#lab-method-checkbox").is(":checked") ? "method" : "individual");
         
       }
       else {
         window.localStorage.removeItem(REMEMBER_SCORES_STORAGE_KEY);
         window.localStorage.removeItem(LAB_METHOD_STORAGE_KEY);
       }
     }

      function refreshLabScores() {
        // const TOTAL_LAB_POINTS = 26;
        const NUM_DROPS = 2;

        if ($("#lab-method-checkbox").is(":checked")) {
          $("#overall-lab-input").val(100);
          $("#lab-entry-message").hide();
          $(".individual-lab-input input").prop("disabled", true);
          $(".lab-drop-label").show();
          $(".lab-drop-label").css("visibility", "hidden");
          return;
        }
        
        
        $(".individual-lab-input input").prop("disabled", false);

        let indiv_labs = $(".individual-lab-input").map(function () {
          const input_elem = $(this).find("input");
          const drop_elem = $(this).find(".lab-drop-label");
          return {
            score: Number.parseFloat(input_elem.val()),
            drop_elem: drop_elem,
            max: input_elem.attr("max")
          };
        }).get();

        // Abort if we don't have scores for everything or a score is out of the valid range
        if (indiv_labs.some(lab => !isValidScore(lab.score, 0, lab.max))) {
          $("#overall-lab-input").val("");
          $("#lab-entry-message").show();
          $(".lab-drop-label").hide();
          return;
        }

        // Sort ascending
        indiv_labs.sort((lab1,lab2) => lab1.score/lab1.max - lab2.score/lab2.max);

        // Remove lowest NUM_DROPS
        const dropped = indiv_labs.splice(0, NUM_DROPS);

        // Compute the overall lab percent.
        // ASSUMPTION: all labs have equal weight.
        const lab_percent = indiv_labs.map(lab => lab.score/lab.max)
          .reduce((x,y) => x + y, 0) / indiv_labs.length * 100;

        $("#overall-lab-input").val(lab_percent);
        $("#lab-entry-message").hide();
        $(".lab-drop-label").show();
        $(".lab-drop-label").css("visibility", "hidden");
        dropped.forEach(d => d.drop_elem.css("visibility", "visible"));
      }

      function refreshReadingScores() {
        const TOTAL_POINTS = 38;
        
        $(".readingQ1 input").prop("disabled", false);
        $(".readingQ2 input").prop("disabled", false);

        let num_indiv_readingQ1 = Number.parseFloat($(".readingQ1 input").val());
        let num_indiv_readingQ2 = Number.parseFloat($(".readingQ2 input").val());


        // Abort if we don't have scores for everything or a score is out of the valid range
        if (num_indiv_readingQ1 + num_indiv_readingQ2 > 24 ||  Number.isNaN(num_indiv_readingQ1) || Number.isNaN(num_indiv_readingQ2) ) {
          $("#overall-readingQ-input").val("");
          $("#readingQ-entry-message").show();
          return;
        }


        // Compute the overall readingQ percent.
        let reading_percent = "";
        if (num_indiv_readingQ2 >= 19){
          reading_percent = 100; // full credit if you get at least 19 lectures with 2 points
        }
        else if (num_indiv_readingQ1 >= 19-num_indiv_readingQ2){
          let reading_points_total = (2*num_indiv_readingQ2) + (19-num_indiv_readingQ2);
          reading_percent = (reading_points_total / TOTAL_POINTS) * 100; // count the 1 point questions until you hit 19 total in the score
        }
        else {
          let reading_points_total = (2*num_indiv_readingQ2) + num_indiv_readingQ1;
          reading_percent = (reading_points_total / TOTAL_POINTS) * 100; // num_indiv_readingQ1 < 19-num_indiv_readingQ2
        }

        $("#overall-readingQ-input").val(reading_percent);
        $("#readingQ-entry-message").hide();
      }
      function refreshHomeworkScores() {
        
        $(".homework1 input").prop("disabled", false);
        $(".homework2 input").prop("disabled", false);
        $(".homework3 input").prop("disabled", false);

        let homework1 = Number.parseFloat($(".homework1 input").val());
        let hw1_max = Number.parseFloat($(".homework1 input").attr("max"));
        let homework2 = Number.parseFloat($(".homework2 input").val());
        let hw2_max = Number.parseFloat($(".homework2 input").attr("max"));
        let homework3 = Number.parseFloat($(".homework3 input").val());


        // Abort if we don't have scores for everything or a score is out of the valid range
        if (!isValidScore(homework1, 0, hw1_max) ||  !isValidScore(homework2, 0, hw2_max) || !isValidScore(homework3)) {
          $("#overall-homework-input").val("");
          // $("#readingQ-entry-message").show();
          return;
        }


        // Compute the overall homework percent. Assuming equal weight
        let homework_percent = "";

        homework_percent = 1/3 * ((homework1 / hw1_max)*100 + (homework2 / hw2_max)*100 + homework3)

        $("#overall-homework-input").val(homework_percent);
        // $("#readingQ-entry-message").hide();
      }
      function refreshParticipationScores() {
        const DM_PRES_MAX = 10;
        $(".dm1 input").prop("disabled", false);
        $(".dm2 input").prop("disabled", false);
        $(".readingPres input").prop("disabled", false);

        let dm1 = Number.parseFloat($(".dm1 input").val());
        let dm2 = Number.parseFloat($(".dm2 input").val());
        let readingPres = Number.parseFloat($(".readingPres input").val());
        let readingQs = Number.parseFloat($("#overall-readingQ-input").val());


        // Abort if we don't have scores for everything or a score is out of the valid range
        if (!isValidScore(readingQs)|| !isValidScore(dm1, 0, DM_PRES_MAX) ||  !isValidScore(dm2, 0, DM_PRES_MAX) || !isValidScore(readingPres, 0, DM_PRES_MAX)) {
          $("#overall-participation-input").val("");
          return;
        }


        // Compute the overall participation percent (including reading Qs).
        let participation_percent = "";

        participation_percent = 1/4 * ((dm1 / DM_PRES_MAX) + (dm2 / DM_PRES_MAX) + (readingPres/DM_PRES_MAX))*100 + 1/4 * readingQs

        $("#overall-participation-input").val(participation_percent);
        // $("#readingQ-entry-message").hide();
      }

      function refreshFinalScores() {
        
        $(".code input").prop("disabled", false);
        $(".description input").prop("disabled", false);
        $(".outline input").prop("disabled", false);
        $(".finalPres input").prop("disabled", false);
        $(".finalReport input").prop("disabled", false);

        let code = Number.parseFloat($(".code input").val());
        let code_max = Number.parseFloat($(".code input").attr("max"));
        let description = Number.parseFloat($(".description input").val());
        let description_max = Number.parseFloat($(".description input").attr("max"));
        let outline = Number.parseFloat($(".outline input").val());
        let outline_max = Number.parseFloat($(".outline input").attr("max"));

        let finalPres= Number.parseFloat($(".finalPres input").val());
        let finalReport= Number.parseFloat($(".finalReport input").val());


        // Abort if we don't have scores for everything or a score is out of the valid range
        if (!isValidScore(code,0,code_max)|| !isValidScore(description, 0, description_max) ||  !isValidScore(outline, 0, outline_max) || !isValidScore(finalPres)|| !isValidScore(finalReport)) {
          $("#overall-final-input").val("");
          return;
        }


        // Compute the overall final percent. 
        let final_percent = "";

        final_percent = (((code/code_max)*WEIGHTS["FPCoC"] +  (description/description_max)*WEIGHTS["FPDesc"] + (outline/outline_max)*WEIGHTS["FPOutline"] ) + finalPres*(WEIGHTS["FPPres"]/100) + finalReport*(WEIGHTS["FPReport"]/100))/ WEIGHTS["final"] *100

        $("#overall-final-input").val(final_percent);
        // $("#readingQ-entry-message").hide();
      }

     function refreshCalculator() {

       // First, update the lab overall based on individual labs
       // and update the lecture percentage based on # of lectures.
       // These must be done before calling extractScores().
       refreshLabScores();
       refreshReadingScores();
       refreshHomeworkScores();
       refreshParticipationScores();
       refreshFinalScores();

       let scores = extractScores();

       updateScoreStorage(scores);

       const total_score = weightedAverage(WEIGHTS, scores);

       if (total_score === undefined) {
         $('.grade-calculator-output').html("?");
         $(".grade-calculator-output-project-warning").hide();
         $(".grade-calculator-output-exam-warning").hide();
         $('.grade-calculator-output-note').html("Please enter valid scores for all assignments to calculate your grade.");
         $(".grade-calculator-output-score-with-lecture").closest(".label").removeClass("disabled");
         $(".grade-calculator-output-score-without-lecture").closest(".label").removeClass("disabled");
         return;
       }

       $('.grade-calculator-output-note').html("Overall Percentage and Final Grade");

       // We DO NOT round anywhere in the calculator. However, we make the final percent more readable
       // by displaying only a certain number of characters after the . in the overall %, followed by ...
       // Note that this will always show a truncated, i.e. rounded down number.
       const NUM_DECIMALS_SHOWN = 5;
       let format_score = (score) => {
         score = "" + score;
         if (score.indexOf(".") === -1) { return score };
         const [n,f] = score.split(".");
         return n + "." + f.slice(0, NUM_DECIMALS_SHOWN) + (f.length > NUM_DECIMALS_SHOWN ? "..." : "");
       }
       
       $(".grade-calculator-output-score").html(format_score(total_score) + "%");


       const overall_percent = total_score;
       
       $(".grade-calculator-output-overall-percent").html(overall_percent + "%");
       let letterGrade = letterGradeForPercent(overall_percent);

       $(".grade-calculator-output-letter-grade").html(letterGrade);
     }

     $(".grade-calculator-input").on("input", refreshCalculator);

     // clear inputs when the clear button is clicked
     $("#calculator-clear").click(function() {
       $(".grade-calculator-input").each(function() {
         let assn = $(this).attr("name");
         $(this).val(null);
       });
       refreshCalculator();
     });

     const REMEMBER_SCORES_STORAGE_KEY = "remember-scores";
     const LAB_METHOD_STORAGE_KEY = "lab-method";

     // On click, update scores (or clear them)
     $("#remember-scores").click(function() {
       updateScoreStorage(extractScores());
     });

     // load the scores from storage if we have them
     const stored_scores = window.localStorage.getItem(REMEMBER_SCORES_STORAGE_KEY);
     if (stored_scores) {
       $("#remember-scores").prop("checked", true);
       loadScoresFromStorage();
       refreshCalculator();
     }

     // If lab mode toggle is clicked, refresh calculator
     $("#lab-method-checkbox").click(function() {
       refreshCalculator();
     });

     refreshCalculator();
     $(".ui.accordion").accordion();

    </script>
  <!-- Footer -->
  <footer class="ui vertical footer segment">
  </footer>

  </body>
</html>
